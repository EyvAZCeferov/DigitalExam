const leftCol=document.getElementsByClassName("left_col"),resizer=document.getElementsByClassName("resizer");let isResizing=!1,offsetX=0,onchangecountdown,loaderVisibleonchange=!1,secondsLeftcountdown=5,show1time=!0,calledtime=0,question_time_reply=0,sec=0,qalan_vaxt,finishmodalshowed=!1,redirect_url=null,allowReload=!1,erroroccurs=!1,errorCount=0,isTonextRunning=!1,clockIntervalId=null;const time_end_exam=document.getElementById("time_end_exam"),time_range_sections=document.getElementById("time_range_sections"),section_start_time=document.getElementById("section_start_time"),time_exam=document.getElementById("time_exam"),next_section=document.getElementById("next_section"),examTimer=new ExamTimer(parseInt(time_end_exam.value,10)||0),timerManager=new TimerManager,tonextDebounced=debounce(async(e,t)=>{await tonext(e,t)},1e3);function togglehours(){var e=document.getElementById("timer_section"),t=document.getElementById("timer_button");e.classList.contains("hide")?(e.classList.remove("hide"),t.text=hide_text):(e.classList.add("hide"),t.text=show_text)}function togglecalculator(){$("#desmoscalculator").toggle(),$("#desmoscalculator").draggable({containment:"body",drag:function(e,t){$(this).css({top:t.position.top+"px",left:t.position.left+"px"})},touchStart:function(e,t){var n=e.originalEvent.touches[0].pageX-$(this).offset().left,a=e.originalEvent.touches[0].pageY-$(this).offset().top;$(this).data("offset",{x:n,y:a})},touchMove:function(e,t){var n=$(this).data("offset"),a=e.originalEvent.touches[0].pageX-n.x,s=e.originalEvent.touches[0].pageY-n.y;$(this).css({top:s+"px",left:a+"px"})}}).resizable({handles:"n, e, s, w, ne, se, sw, nw",minHeight:200,minWidth:200})}function touchHandler(e){var t=e.changedTouches[0],n=document.createEvent("MouseEvent");n.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[e.type],!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(n)}function init(){document.addEventListener("touchstart",touchHandler,!0),document.addEventListener("touchmove",touchHandler,!0),document.addEventListener("touchend",touchHandler,!0),document.addEventListener("touchcancel",touchHandler,!0)}function togglereferances(){$("#references")&&$("#references").toggle(),$("#references")&&$("#references").draggable()}function toggleClass(e,t,n){e&&e.classList[n?"add":"remove"](t)}function toback(){try{showLoader();var e=document.getElementById("current_question").value,t=document.getElementsByClassName("content_exam")[0],n=document.getElementById(`content_exam_${e}`);if(showfinishmodal("hide"),e==t.dataset.id)hideLoader();else{toggleClass(n,"show",!1);var a=parseInt(n.dataset.key)-1;document.querySelectorAll(`.content_exam[data-key="${a}"]`).forEach(function(e){e.classList.add("show"),document.getElementById("current_question").value=e.dataset.id,document.getElementById("current_section_name").value=e.dataset.section_name,document.getElementById("current_section").value=e.dataset.section_id}),stopaudios(),hideLoader()}question_time_reply=0}catch(s){hideLoader(),toast(s,"error")}}function togglequestions(e=!1){var t=document.getElementById("footer_questions");showfinishmodal("hide"),t.classList.contains("active")?t.classList.remove("active"):t.classList.add("active"),!0==e&&showfinishmodal("open")}async function tonext(e=!1,t=null){try{if(isTonextRunning)return;isTonextRunning=!0,showLoader();var n=document.getElementById("current_question").value,a=document.getElementById("all_questions").value,s=document.getElementById(`content_exam_${n}`),o=document.getElementById("loader_for_sections"),i=document.getElementById("exam");if(question_time_reply=0,stopaudios(),a==s.dataset.key||!0==e){if(!1==finishmodalshowed&&!1==e)hideLoader(),showfinishmodal("open");else if("imtahanzamanibitdi"==t&&!0==next_section.value&&time_range_sections.value>0)time_range_sections.value=time_range_sections.value-1,time_range_sections.value>0?(hideLoader(),1==next_section.value&&(section_start_time.value=time_exam.value,i.classList.remove("d-block"),i.style.display="none",o.classList.add("active"))):(allowReload=!0,await tonext(!0,"imtahanzamanibitdi"));else{var l=document.getElementById("exam"),r=new FormData(l);calledtime++;var d=document.getElementById("page_type");d&&d.value&&"result"==d.value?window.location.href="/":(fetch("/api/finish_exam",{method:"POST",body:r}).then(e=>{if(!e.ok)throw Error("Network response was not ok.");return e.json()}).then(e=>{if(e.message&&toast(e.message,e.status),hideLoader(),"success"==e.status)null!=e.url&&""!=e.url&&" "!=e.url&&(redirect_url=e.url,errorCount=0,erroroccurs=!1),!1==e.nextsection&&(allowReload=!0,window.location.href=e.url),"imtahanzamanibitdi"==t&&(allowReload=!0,window.location.href=e.url,section_start_time.value=0,sec=0,time_exam.value=0);else{toast("Şəbəkədə problem var. 3 saniyə ərzində yenidən yoxlanılacaq...","info");let n=e=>new Promise(t=>setTimeout(t,e));async function a(){await n(3e3);try{await tonext(!0)}catch(e){console.error(e)}}a()}}).catch(async n=>{hideLoader(),console.log("Bu funksiya isledi"),erroroccurs=!0,errorCount++,toast("İnternet xətası yenidən yoxlanılır!","error"),errorCount>5?toast("İnternet bağlantısı yok. L\xfctfen bağlantınızı kontrol edin ve tekrar deneyin.","error"):(toast("İnternet xətası yenidən yoxlanılır!","error"),setTimeout(async()=>{await tonext(e,t)},1500))}),time_range_sections.value>0&&(hideLoader(),1==next_section.value&&(section_start_time.value=time_exam.value,i.classList.remove("d-block"),i.style.display="none",o.classList.add("active"))))}}else{toggleClass(s,"show",!1);var c=parseInt(s.dataset.key)+1;document.querySelectorAll(`.content_exam[data-key="${c}"]`).forEach(function(e){e.classList.add("show"),document.getElementById("current_question").value=e.dataset.id,document.getElementById("current_section_name").value=e.dataset.section_name,document.getElementById("current_section").value=e.dataset.section_id}),hideLoader()}}catch(u){console.error("Buradadir 2 xeta"),console.log(u),erroroccurs=!0,++errorCount>5?toast("İnternet bağlantısı yok. L\xfctfen bağlantınızı kontrol edin ve tekrar deneyin.","error"):(toast("İnternet xətası yenidən yoxlanılır!","error"),setTimeout(async()=>{await tonext(e,t)},1500))}finally{isTonextRunning=!1}}function showfinishmodal(e){var t=document.getElementById("showfinishmodal"),n=document.getElementById("content_area_exam"),a=document.getElementById("footer_questions"),s=document.getElementById("footer_questions_top");"open"==e?(finishmodalshowed=!0,t.classList.remove("hide"),s.innerHTML=a.innerHTML,n.classList.add("hide")):(finishmodalshowed=!1,t.classList.add("hide"),s.innerHTML="",n.classList.remove("hide"))}function searchinarray(e,t){for(var n=!1,a=0;a<e.length;a++)if(e[a]==t){n=!0;break}return n}function updatepad(){for(var e=document.getElementById("current_question").value,t=document.getElementById("first_question").value,n=document.getElementsByClassName("footer_question_buttons"),a=document.getElementById("marked_questions").value,s=0;s<n.length;s++){let o=n[s];o.classList.remove("current"),o.classList.contains("saved")&&o.classList.remove("saved"),null!=a&&a.length>0&&!0==searchinarray(marked_questions_jsoned=JSON.parse(a),o.getAttribute("data-key"))&&o.classList.add("saved")}e==t?document.getElementById("to_back").classList.add("hide"):document.getElementById("to_back").classList.contains("hide")&&document.getElementById("to_back").classList.remove("hide");var i=document.getElementById("all_questions").value;document.getElementById(`question_row_button_${e}`);var l=document.getElementsByClassName("btn-question"),r=document.getElementById(`content_exam_${e}`),d=document.getElementById("next_button"),c=document.getElementById("time_range_sections").value,u=document.getElementById("next_section").value;i==r.dataset.key?(d.classList.remove("btn-secondary"),d.classList.add("active"),c>0?1==u?d.innerHTML=layout_standart_right:d.innerHTML=referances_standart_check:d.innerHTML=rf_open_check):(d.classList.add("btn-secondary"),d.classList.remove("active"),d.innerHTML=rf_aaa),document.getElementById("current_question_text").innerText=r.dataset.key;for(var s=0;s<l.length;s++)l[s].id==`question_row_button_${e}`&&l[s].classList.add("current");var m=document.getElementById("section_name"),g=document.getElementById("current_section_name").value;m.innerText=g}function getquestion(e){try{showLoader();var t=document.getElementsByClassName("content_exam");showfinishmodal("hide");for(var n=0;n<t.length;n++)t[n].classList.remove("show");document.getElementById(`content_exam_${e}`).classList.add("show"),document.getElementById("current_question").value=e,question_time_reply=0,togglequestions(),hideLoader()}catch(a){hideLoader(),toast(a,"error")}}function pad(e){return e.toString().padStart(2,"0")}function pad_new(e){return e>9?e:"0"+e}async function updateClock(){sec++,question_time_reply++,time_exam.value=sec;var e=document.getElementById("loader_for_sections");let t=examTimer.getRemainingTime();if(e&&e.classList.contains("active")&&section_start_time.value>0){let n=(qalan_vaxt=calculateRemainingTime(section_start_time.value,time_range_sections.value,time_exam.value))>0?Math.floor(qalan_vaxt/60):0,a=qalan_vaxt>0?qalan_vaxt%60:0;var s=document.getElementById("page_type");(!s||"result"!==s.value)&&(document.getElementById("seconds_start_time")&&(document.getElementById("seconds_start_time").innerHTML=pad_new(a)),document.getElementById("minutes_start_time")&&(document.getElementById("minutes_start_time").innerHTML=pad_new(n)),qalan_vaxt<=0&&(erroroccurs&&await tonextDebounced(!0,"imtahanzamanibitdi"),allowReload=!0,null!=redirect_url?(timerManager.clearTimer("updateClock"),window.location.href=redirect_url):await tonextDebounced(!0,"imtahanzamanibitdi")))}else section_start_time.value=0,allowReload=!0;if(t<=0){timerManager.clearAll(),allowReload=!0,document.getElementById("minutes")&&(document.getElementById("minutes").innerHTML="00"),document.getElementById("seconds")&&(document.getElementById("seconds").innerHTML="00");var s=document.getElementById("page_type");s&&"result"===s.value||setTimeout(()=>{tonext(!0,"imtahanzamanibitdi")},1e3);return}var s=document.getElementById("page_type");(!s||"result"!==s.value)&&(document.getElementById("seconds")&&(document.getElementById("seconds").innerHTML=pad_new(Math.floor(t%6e4/1e3))),document.getElementById("minutes")&&(document.getElementById("minutes").innerHTML=pad_new(Math.floor(t/6e4)))),settimerforcurrentquestion()}function settimerforcurrentquestion(){if(document.getElementById("current_question")){var e=document.getElementById("current_question").value,t=document.getElementById(`question_time_replies_${e}`);if(t){let n=parseInt(t.value,10)||0;t.value=n+1}}}function onchangeShowLoader(){if(loaderVisibleonchange=!0,!0==show1time)alert(if_change_window_tab_text),show1time=!1,allowReload=!0;else{var e=`<div id="modalshowcountdown" class="modal custom-modal show" tabindex="-1" role="dialog"
                    aria-labelledby="myModalLabel">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-body text-muted text-large my-1">
                                <div class='my-1 d-flex '>
                                    <span class='d-inline-block' id='minutescountdown'>00</span><span class='d-inline-block'>:</span><span
                                        id='secondscountdown' class='d-inline-block'>05</span>
                                </div>
                                <div class='text-center text-danger'>
                                    ${if_change_window_tab_text}
                                </div>
                            </div>
                        </div>
                    </div>
                    <br>
                </div>`;document.body.innerHTML+=e,toggleModalnow("modalshowcountdown","open")}onchangeStartCountdown()}function onchangeStartCountdown(){onchangecountdown=setInterval(async function(){if(0==secondsLeftcountdown){loaderVisibleonchange=!1;var e=document.getElementById("modalshowcountdown");null!=e?setTimeout(()=>{toggleModalnow("modalshowcountdown","hide"),e.remove()},1e3):clearInterval(onchangecountdown),await tonext(!0)}var t=document.getElementById("page_type");t&&t.value&&"result"==t.value||null==document.getElementById("secondscountdown")||(document.getElementById("secondscountdown").innerHTML=`0${secondsLeftcountdown}`),secondsLeftcountdown--},1e3)}function stopaudios(){var e=document.querySelectorAll(".only1time");e.length>0&&e.forEach(function(e){e.paused||e.ended||e.pause()})}function toggle_references_modal_content_element(e){var t=document.getElementById(`toggler_button_reference_${e}`),n=document.getElementById(`body_reference_${e}`);n.classList.contains("hide")?(n.classList.remove("hide"),t.innerHTML='<i class="fa fa-minus"></i>'):(n.classList.add("hide"),t.innerHTML='<i class="fa fa-plus"></i>')}function toggle_references_modal_content(e){for(var t=document.getElementsByClassName("referance_toggle_button"),n=document.getElementsByClassName("referance_body"),a=0;a<t.length;a++)"open"==e?t[a].innerHTML='<i class="fa fa-minus"></i>':t[a].innerHTML='<i class="fa fa-plus"></i>';for(var a=0;a<n.length;a++)"open"==e?n[a].classList.remove("hide"):n[a].classList.add("hide")}function toggledesmosmodal(e){showLoader();var t=document.getElementById(e),n=document.getElementById("desmos_expandable");t.classList.contains("modal-lg")?(t.classList.remove("modal-lg"),n.innerHTML='<i class="fa fa-expand-alt"></i>'):(t.classList.add("modal-lg"),n.innerHTML='<i class="fa fa-compress-alt"></i>'),hideLoader()}function increase_decrease_font(e){for(var t=document.getElementsByClassName("content_exam_info"),n=0;n<t.length;n++){var a=parseInt(window.getComputedStyle(t[n]).fontSize);"increase"===e?t[n].style.fontSize=a+1+"px":"decrease"===e&&(t[n].style.fontSize=a-1+"px");for(var s=t[n].getElementsByTagName("p"),o=t[n].getElementsByTagName("span"),i=0;i<s.length;i++){var l=parseInt(window.getComputedStyle(s[i]).fontSize);"increase"===e?s[i].style.fontSize=l+1+"px":"decrease"===e&&(s[i].style.fontSize=l-1+"px")}for(var r=0;r<o.length;r++){var d=parseInt(window.getComputedStyle(o[r]).fontSize);"increase"===e?o[r].style.fontSize=d+1+"px":"decrease"===e&&(o[r].style.fontSize=d-1+"px")}}}function select_answer(e,t,n){var a=document.getElementById("all_questions").value,s=document.getElementById(`content_exam_${e}`),o=document.getElementsByClassName(`answers_${e}`),i=document.getElementById(`question_answer_one_${e}_${t}_${n}`),l=i.querySelector('input[type="radio"]'),r=i.querySelector('input[type="checkbox"]');if(set_question_value_on_session(e,t,n),!i.classList.contains("removable")){if("radio"==n)for(var d=0;d<o.length;d++){o[d].classList.remove("selected");var c=o[d].querySelector('input[type="radio"]');c&&(c.checked=!1)}i.classList.toggle("selected"),l&&(l.checked=i.classList.contains("selected")),r&&(r.checked=i.classList.contains("selected")),s.dataset.key,document.getElementById(`question_row_button_${e}`).classList.add("answered"),updatepad()}}function changeTextBox(e,t){var n=document.getElementById(`question_answer_one_${e}_${t}`).value;n.length>5&&(document.getElementById(`question_answer_one_${e}_${t}`).value=n.substring(0,5));var a=document.getElementById(`question_row_button_${e}`),s=document.getElementById(`question_textbox_text_span_${e}`);if(null!==s&&(s.innerHTML=""),(n=document.getElementById(`question_answer_one_${e}_${t}`).value).length>0&&null!=n&&""!=$.trim(n)&&null!=$.trim(n)&&" "!=$.trim(n)){var o=n.split("/");if(a.classList.add("answered"),2===o.length){var i=o[0],l=o[1],r=katex.renderToString(`\\frac{${i}}{${l}}`,{throwOnError:!1,displayMode:!0});s.innerHTML=`<span>${r}</span>`,set_question_value_on_session(e,r,t)}else s.innerHTML=`${n}`,set_question_value_on_session(e,n,t)}else a.classList.remove("answered"),s.innerHTML=""}function mark_unmark_question(e){let t=document.getElementById("exam_id").value,n=document.getElementById("exam_result_id").value,a=document.getElementById("user_id").value,s=document.getElementById("language").value,o=document.getElementById(`mark_question_button_${e}`);o.classList.contains("active")?(o.classList.remove("active"),o.innerHTML='<i class="far fa-bookmark"></i>'):(o.classList.add("active"),o.innerHTML='<i class="fa fa-bookmark"></i>'),sendAjaxRequestOLD("/api/mark_unmark_question","post",{question_id:e,exam_id:t,exam_result_id:n,language:s,user_id:a},function(e,t){if(e)toast(e,"error");else try{if(t){let n=JSON.parse(t);toast(n.message,n.status),document.getElementById("marked_questions").value=JSON.stringify(n.data)}}catch(a){toast("İnternet xətası yenidən yoxlanılır...","error")}})}function draggingleftandrightcolumns(){for(let e=0;e<resizer.length;e++){let t=resizer[e];t.addEventListener("mousedown",startResize),t.addEventListener("touchstart",startResize),t.addEventListener("mouseover",handleMouseOver),t.addEventListener("mouseleave",handleMouseLeave)}}function startResize(e){isResizing=!0,offsetX="mousedown"===e.type?e.clientX:e.touches[0].clientX,document.addEventListener("mousemove",resize),document.addEventListener("touchmove",resize),document.addEventListener("mouseup",stopResize),document.addEventListener("touchend",stopResize)}function resize(e){if(!isResizing)return;var t=0;t=e&&"touchstart"===e.type?e.touches[0].clientX-(e.srcElement.getBoundingClientRect().left||e.srcElement.offsetLeft):e.layerX>0?e.clientX-(e.layerX+e.srcElement.offsetLeft):e.clientX-e.srcElement.offsetLeft;let n=`${e.touches?e.touches[0].clientX:e.clientX-t}px`;for(let a=0;a<leftCol.length;a++){let s=leftCol[a];s.style.width=n}}function stopResize(){isResizing=!1,document.removeEventListener("mousemove",resize),document.removeEventListener("touchmove",resize),document.removeEventListener("mouseup",stopResize),document.removeEventListener("touchend",stopResize)}function handleMouseOver(e){isResizing||(e.currentTarget.style.opacity=1)}function handleMouseLeave(e){isResizing||(e.currentTarget.style.opacity=.5)}function sortanswerarea(){let e=document.getElementsByClassName("answers_match_area");if(null!=e&&e.length>0)for(let t=0;t<e.length;t++){let n=e[t];$(`#${n.id}`).sortable({start:function(e,t){var n=t.item[0],a=n.dataset.question_id,s=n.dataset.section_id;document.getElementById(`question_row_button_${a}`).classList.add("answered"),document.getElementById(`question_match_element_${s}_${a}`).value=1}}),$(`#${n.id}`).disableSelection()}}function toggleabcline(e,t){let n=document.getElementById(`question_answer_one_${e}_${t}_radio`),a=document.getElementById(`question_answer_one_${e}_${t}_checkbox`),s=document.getElementById(`question_container_undo_or_redo_${e}_${t}`);if(n){let o=n.classList.contains("removable");n.classList.toggle("removable"),s.innerHTML=o?`<img src="${aplus_icon_path}" class="img-fluid img-responsive" />`:`<span>${undo_text}</span>`}if(a){let i=a.classList.contains("removable");a.classList.toggle("removable"),s.innerHTML=i?`<img src="${aplus_icon_path}" class="img-fluid img-responsive" />`:`<span>${undo_text}</span>`}}function remove_button_toggler(){let e=Array.from(document.getElementsByClassName("remove_button")),t=Array.from(document.getElementsByClassName("btn-question_container_undo_or_redo")),n=Array.from(document.getElementsByClassName("question_answer_one")),a=!t[0]?.classList.contains("show");t.forEach(e=>{e.classList.toggle("show",a)}),a||(n.forEach(e=>{e.classList.remove("removable")}),t.forEach(e=>{e.innerHTML=`<img src="${aplus_icon_path}" class="img-fluid img-responsive" />`})),e.forEach(e=>{e.classList.toggle("active")})}function set_question_value_on_session(e,t=null,n){try{var a=document.getElementById("exam_id").value,s=document.getElementById("exam_result_id").value,o=document.getElementById("user_id").value,i=document.getElementById("language").value,l=document.querySelector('meta[name="_token"]').getAttribute("content");sendAjaxRequestOLD("/exams_set_question_value_on_session","post",{exam_id:a,result_id:s,language:i,user_id:o,question_id:e,answer_id:t,type_value:n,_token:l},function(e,t){try{t&&JSON.parse(t)}catch(n){}})}catch(r){console.log(r)}}function stopPrntScr(){var e=document.createElement("input");e.setAttribute("value","."),e.setAttribute("width","0"),e.style.height="0px",e.style.width="0px",e.style.border="0px",document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(e)}function AccessClipboardData(){try{window.clipboardData.setData("text","Access   Restricted")}catch(e){}}function copyToClipboard(){var e=document.createElement("input");e.setAttribute("value","print screen disabled!"),document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),toast("@lang('additional.messages.noprint')","error")}window.addEventListener("load",function(){init(),timerManager.setTimer("updatepad",updatepad,500);var e=document.getElementById("page_type");e&&"result"===e.value||timerManager.setTimer("updateClock",updateClock,1e3)}),setInterval(async()=>{!0==erroroccurs&&await tonext(!0,"imtahanzamanibitdi")},5e3),window.addEventListener("load",function(){init(),timerManager.setTimer("updatepad",updatepad,500);var e=document.getElementById("page_type");e&&"result"===e.value||timerManager.setTimer("updateClock",updateClock,1e3)}),document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!0},{left:"\\[",right:"\\]",display:!0},],throwOnError:!1})}),document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".only1time").forEach(function(e){e.addEventListener("play",function(t){e.controls=!1;var n=document.querySelector(".audio_tag_text");n.innerHTML+=`<span class="text-info">${audio_file_played_text}</span>`,e.removeEventListener("play",arguments.callee)},{once:!0})})}),window.addEventListener("load",function(){draggingleftandrightcolumns(),sortanswerarea()}),document.addEventListener("keyup",function(e){44==(e.keyCode?e.keyCode:e.which)&&stopPrntScr()}),setInterval(AccessClipboardData(),300),$(window).keyup(function(e){44==e.keyCode&&copyToClipboard()}),showLoader();